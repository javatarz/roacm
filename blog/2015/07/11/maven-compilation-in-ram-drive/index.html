<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="Description" content="Karun Japhet's blog">
  <title>Ramblings of a Coder's Mind by Karun Japhet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

  <body>
    <div class="wrapper">
      <header>
  <h1 class="header"><a href="/">Ramblings of a Coder's Mind</a></h1>
  <p class="header">Got Tech? Will Hack.</p>
</header>


      <section>
        <section>
  <h1 class="entry-title">Maven Compilation in Ram Drive</h1>
  <p>If you’re working on huge maven projects and have a slow disk, compilation, packaging and install times can sore quite high. If getting faster hard disks isn’t possible, why not try moving the compilation to a ram drive?</p>

<p>A code base which used to take <strong>22 minutes</strong> to compile went down to <strong>3 minutes</strong>. This just goes to show the effect that disk IO bottlenecks can have on your system.</p>

<!-- more -->

<h1 id="what-is-a-ram-drive">What is a RAM Drive?</h1>

<p>RAM is significantly faster than spinning platter HDDs. Until the commercialisation of static state devices, it wasn’t even a competition. <a href="https://en.wikipedia.org/wiki/Memory_hierarchy" target="_blank" rel="noopener noreferrer">It’s meant to be like that</a>.</p>

<p>If you need higher writes speeds to <em>disk</em> which don’t need to be persisted over a long period of time, why not use some of your spare RAM as a hard disk? This can be achieved using software.</p>

<h2 id="how-do-i-get-a-ram-drive-on-my-machine">How do I get a RAM drive on my machine?</h2>

<p>RAM drive softwares are available for all major operating systems.</p>

<p><a href="https://www.softperfect.com/products/ramdisk/" target="_blank" rel="noopener noreferrer">SoftPerfect’s RAM Disk</a> is a good free tool for non-commercial processes for Windows. Linux has <a href="https://en.wikipedia.org/wiki/Tmpfs" target="_blank" rel="noopener noreferrer">tempfs</a> and <a href="https://wiki.debian.org/ramfs" target="_blank" rel="noopener noreferrer">ramfs</a>.</p>

<h1 id="compiling-your-maven-project-on-to-a-ram-drive">Compiling your Maven project on to a RAM drive</h1>

<p>Most big projects follow a multi-module POM structure. You can move your target directory in 2 ways.</p>

<h2 id="change-build-directory">Change build directory</h2>

<p>You can change the output directory to the desired path ensuring all compiled files go to your RAM drive. Just make sure you qualify your path well using the group and artifact IDs to ensure different projects don’t overwrite each other’s compiled code.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;build&gt;
    &lt;directory&gt;
      &lt;strong&gt;/mnt/ramdrive/compile/${project.groupId}/${project.artifactId}&lt;/strong&gt;
    &lt;/directory&gt;
  &lt;/build&gt;</code></pre></figure>

<p>The issue with this approach is that all users on the team are now bound by</p>

<ol>
  <li>Your compilation directory path (terrible idea)</li>
  <li>Using a ram drive (not everyone might need it)</li>
</ol>

<p>The first issue can be fixed by creating a property for the base path. This parameter can be passed as a compile time parameter with a default set in the POM</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;build&gt;
    &lt;directory&gt;
      &lt;strong&gt;${target.baseDir}&lt;/strong&gt;/${project.groupId}/${project.artifactId}
    &lt;/directory&gt;
  &lt;/build&gt;</code></pre></figure>

<p>The second issue can’t be fixed using this approach. This can be fixed with the second approach</p>

<h2 id="compilation-profiles">Compilation profiles</h2>

<p>Maven allows you to have profiles for applying configs in specific scenarios.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;&lt;strong&gt;ramDrive&lt;/strong&gt;&lt;/id&gt;
      &lt;build&gt;
        &lt;directory&gt;
          ${target.baseDir}/${project.groupId}/${project.artifactId}
        &lt;/directory&gt;
      &lt;/build&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;</code></pre></figure>

<p>Now you can compile your code with a profile and it will use the specified directory for compilation</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">mvn clean install -P&lt;strong&gt;ramDrive&lt;/strong&gt; -D&lt;strong&gt;target.baseDir=/mnt/ramdrive/compile&lt;/strong&gt;</code></pre></figure>

<p>Congratulations, your code is compiled on RAM drive. Is it still not fast enough? Is the installation process slow? Well, you could move your M2 directory to the ram drive too</p>

<h1 id="local-maven-repository-to-ram-drive">Local Maven repository to RAM drive</h1>

<p>You can change your maven configuration to ask it to move your local maven repository home (which is the place where all the artifacts you build and/or download are stored).</p>

<p>Update your settings.xml with the location of your local repository</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;localRepository&gt;/mnt/ramdrive/mvn-repo&lt;/localRepository&gt;</code></pre></figure>



  <span>
  

  <strong>Created</strong>: 11th July 2015
  
</span>
<br>
  

<span>
  <strong>Categories</strong>:
  Development, Hacks
</span>

<br>
  

<span>
  <strong>Tags</strong>:
  Linux, Windows, hard disk, maven, optimization, performance, ram, ram drive, ramfs, tempfs
</span>



  
    <h2>Comments</h2>

    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'https://blog.karun.me/blog/2015/07/11/maven-compilation-in-ram-drive/';
        this.page.identifier = 'https://blog.karun.me/blog/2015/07/11/maven-compilation-in-ram-drive/';
      };

      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://roacm.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="noopener noreferrer" target="_blank">comments powered by Disqus.</a>
</noscript>
  
</section>

      </section>

      <footer>
  <h3>About</h3>
  <p><a href="https://karun.me" target="_blank" rel="noopener noreferrer">Karun Japhet</a> is a human.<br>Writes code at Sahaj Software. Speaks publicly about scaling software, testing, CD &amp; ML. Loves riding motorcycles and playing CS:GO</p>
  <p><small><a href="/about">Read on →</a></small></p>

  <h3>Contact</h3>
  <p id="contact">
      
      <a href="https://github.com/javatarz" aria-label="GitHub" target="_blank" rel="noopener noreferrer"><i class="fab fa-github fa-lg"></i></a>
      
      <a href="https://stackoverflow.com/users/499797" aria-label="Stack Overflow" target="_blank" rel="noopener noreferrer"><i class="fab fa-stack-overflow fa-lg"></i></a>
      
      <a href="https://twitter.com/javatarz" aria-label="Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter fa-lg"></i></a>
      
      <a href="https://www.linkedin.com/in/karunjaphet" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-linkedin fa-lg"></i></a>
      
      <a href="mailto:karun@japhet.in" rel="tooltip" title="karun@japhet.in" target="_blank"><i class="fa fa-envelope fa-lg"></i></a>
      <a href="/atom.xml" title="RSS Feed" target="_blank" rel="noopener"><i class="fa fa-rss fa-lg"></i></a>
  </p>

  <p>
    <small>
      Copyright © 2006 - 2021 <br>
      <a href="https://karun.me" target="_blank" rel="noopener noreferrer">Karun Japhet</a> <br>
      Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>
    </small>
  </p>
</footer>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    

    

    <noscript id="deferred-styles">
    <link href="https://fonts.googleapis.com/css?family=Arvo:400,700,400italic" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/roacm/assets/css/style.css?v=">
    <link rel="stylesheet" href="/roacm/assets/css/overrides.css?v=">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/solid.css" integrity="sha384-rdyFrfAIC05c5ph7BKz3l5NG5yEottvO/DQ0dCrwD8gzeQDjYBHNr1ucUpQuljos" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/brands.css" integrity="sha384-QT2Z8ljl3UupqMtQNmPyhSPO/d5qbrzWmFxJqmY7tqoTuT2YrQLEqzvVOP2cT5XW" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/fontawesome.css" integrity="sha384-u5J7JghGz0qUrmEsWzBQkfvc8nK3fUT7DCaQzNQ+q4oEXhGSx+P2OqjWsfIRB8QT" crossorigin="anonymous">
    <script src="/roacm/assets/js/scale.fix.js"></script>
</noscript>
<script>
    var loadDeferredStyles = function() {
    var addStylesNode = document.getElementById("deferred-styles");
    var replacement = document.createElement("div");
    replacement.innerHTML = addStylesNode.textContent;
    document.body.appendChild(replacement)
    addStylesNode.parentElement.removeChild(addStylesNode);
    };
    var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
        window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    if (raf) raf(function() { window.setTimeout(loadDeferredStyles, 0); });
    else window.addEventListener('load', loadDeferredStyles);
</script>

  </body>
</html>
