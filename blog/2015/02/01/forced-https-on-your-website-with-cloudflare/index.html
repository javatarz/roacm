<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="Description" content="Karun Japhet's blog">
  <title>Ramblings of a Coder's Mind by Karun Japhet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

  <body>
    <div class="wrapper">
      <header>
  <h1 class="header"><a href="/">Ramblings of a Coder's Mind</a></h1>
  <p class="header">Got Tech? Will Hack.</p>
</header>


      <section>
        <section>
  <h1 class="entry-title">Forced HTTPs on your website with CloudFlare</h1>
  <p>I’m a supporter of the <a href="https://www.eff.org/https-everywhere" target="_blank" rel="noopener noreferrer">HTTPS everywhere movement</a> by the <a href="https://www.eff.org/" target="_blank" rel="noopener noreferrer">EFF</a>. They advocate users use (all) websites with HTTPS for extra security. This means everyone should probably fork out a few dollars to get their own certificates. Unless you’re buying a domain at NameCheap (in which case they tend to throw in a SSL certificate for the first year), you’d have to shell out $8-$12 to get one.</p>

<p>Side note, I recommend every user have <a href="https://www.eff.org/https-everywhere" target="_blank" rel="noopener noreferrer">HTTPS everywhere</a> installed on every browser.</p>

<p>Though it’s not perfect, you can get a SSL for your website for free.</p>

<!-- more -->

<h2 id="whydo-i-need-ssl">Why do I need SSL?</h2>

<p>The communication between you and a website looks something like this without SSL.</p>

<p><img src="https://blog.karun.me/assets/images/uploads/No-SSL-Setup.png" alt="No SSL Setup"></p>

<p>It’s prone to a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">Man in the middle attack</a>. This could be done by your neighbour tapping into the line, your ISP or someone half way across the world listening in on the server you request data from.</p>

<h2 id="what-would-you-have-me-do">What would you have me do?</h2>

<h3 id="move-your-domain-to-cloudflare">Move your domain to CloudFlare</h3>

<p>CloudFlare is a CDN that provides you with additional security by analysing requests using crowd sourced data over hundreds and thousands of websites. Add your domain to CloudFlare and ask your DNS provider to send all requests to the CloudFlare servers. Once the setup is complete, your data will be sent to your server via CloudFlare. It ensures your IP is not exposed outside there by providing it with some amount of Denial of Service attack prevention since your IP is not directly exposed and it is CloudFlare’s job to handle in coming Denial of Service attacks (once set up).</p>

<p><img src="https://blog.karun.me/assets/images/uploads/With-CloudFlare.png" alt="With CloudFlare"></p>

<p>Users must note that the move to CloudFlare means you can’t SSH to your machine anymore because they do not forward the port. You can create a subdomain that doesn’t route traffic through CloudFlare. That makes it easier to SSH/FTP into the box but provides a way for attackers to access your machine bypassing CloudFlare’s security. Alternately you can add a vhost entry on your machine ensuring you can connect with ease but this won’t help you if you would like to connect from some other machine. You could just remember the IP if you’re a pro :P The choice is yours!</p>

<h3 id="enable-cloudflares-universal-ssl">Enable CloudFlare’s Universal SSL</h3>

<p><img src="https://blog.karun.me/assets/images/uploads/cloudflare-ssl-config.png" alt="CloudFlare SSL Config"></p>

<p>CloudFlare provides a universal SSL for all domains routed through their service. As long as you trust CloudFlare’s SSL keys not to be leaked (if they do, bigger businesses would have a problem way before your website does).</p>

<p>This feature is available for free to all users. I recommend using at least the Flexible SSL which requires no further setup. Turn it on and you can hit your website using https. For now, choose <strong>Flexible SSL</strong>.</p>

<h3 id="force-https">Force HTTPS</h3>

<p>Ideally you want HTTPS to be an option your users choose. You’d want to at least make it a default. If people don’t know, they wouldn’t move to using it. I see no reason why browsers these days won’t be showing your content correctly if they are in HTTPS so I recommend having it on as a default.</p>

<p>If you run a blog or website where there are no “users” but readers, it’s hard to let them choose their HTTPS settings. If you haven’t noticed already, you are accessing this website using HTTPS. Welcome to the dark side.</p>

<p>No need to write a htaccess or similar config on your server. Go to CloudFlare and create a HTTP rule for your base domain asking for a redirect to HTTPS.</p>

<h2 id="are-we-there-yet">Are we there yet?</h2>

<p>Not quite.</p>

<p><img src="https://blog.karun.me/assets/images/uploads/With-CloudFlare-Universal-SSL.png" alt="With CloudFlare Universal SSL"></p>

<p>The communication between you and CloudFlare is secure. The communication between CloudFlare and your server isn’t.</p>

<h3 id="adding-ssl-for-cloudflare-server-communication">Adding SSL for CloudFlare-Server communication</h3>

<p>You can create a self signed certificate on your server. For any Unix based server you can use OpenSSL to generate it. The internet is filled with tutorials galore. Most of them will have information on how to install with your web server of choice (for example apache or nginx).</p>

<p>Once you’re done, go back to the CloudFlare settings for your domain and change the option to <strong>Full SSL</strong>.</p>

<p><img src="https://blog.karun.me/assets/images/uploads/With-End-to-End-Security.png" alt="With End to End Security"></p>

<h1 id="potential-flaws">Potential Flaws?</h1>

<p>You’re <em>pretty</em> secure if you ask me. The vulnerable points in the system are the CloudFlare server and your server. Ideally, CloudFlare protects the identity of the server ensuring all requests go through their servers which are meant to protect you from attacks. Lets assume CloudFlare’s private key isn’t compromised. This means the only way to decrypt requests to your server is by getting the private key off your machine and listening into requests to your server.</p>

<p>Another potential area of concern is the fact that the CloudFlare to server communication is prone to a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">Man in the middle attack</a> since CloudFlare doesn’t verify the signature from from the server for free accounts. For this, you would need to move to a <a href="https://www.cloudflare.com/plans.html" target="_blank" rel="noopener noreferrer">CloudFlare Pro account</a> which at $20/month (as of the writing of this post) is significantly more expensive than purchasing your own SSL certificate end to end. Of course, we don’t use CloudFlare just for the free SSL but the CDN and crowd sourced security it provides. This is hands down <strong>the most serious vulnerability in the system</strong> I can spot.</p>

<p>You’re better off than where you started and all this for free! Want more? Shell out money to a CA to get your very own certificate :)</p>

<p><em>*[CA]: Certificate Authority</em></p>


  <span>
  

  <strong>Created</strong>: 1st February 2015
  
</span>
<br>
  

<span>
  <strong>Category</strong>:
  Tutorials
</span>

<br>
  

<span>
  <strong>Tags</strong>:
  security, ssl
</span>



  
    <h2>Comments</h2>

    <div id="disqus_thread"></div>
    <script>
      var disqus_config = function () {
        this.page.url = 'https://blog.karun.me/blog/2015/02/01/forced-https-on-your-website-with-cloudflare/';
        this.page.identifier = 'https://blog.karun.me/blog/2015/02/01/forced-https-on-your-website-with-cloudflare/';
      };

      (function() {
        var d = document, s = d.createElement('script');
        s.src = 'https://roacm.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="noopener noreferrer" target="_blank">comments powered by Disqus.</a>
</noscript>
  
</section>

      </section>

      <footer>
  <h3>About</h3>
  <p><a href="https://karun.me" target="_blank" rel="noopener noreferrer">Karun Japhet</a> is a human.<br>Writes code at Sahaj Software. Speaks publicly about scaling software, testing, CD &amp; ML. Loves riding motorcycles and playing CS:GO</p>
  <p><small><a href="/about">Read on →</a></small></p>

  <h3>Contact</h3>
  <p id="contact">
      
      <a href="https://github.com/javatarz" aria-label="GitHub" target="_blank" rel="noopener noreferrer"><i class="fab fa-github fa-lg"></i></a>
      
      <a href="https://stackoverflow.com/users/499797" aria-label="Stack Overflow" target="_blank" rel="noopener noreferrer"><i class="fab fa-stack-overflow fa-lg"></i></a>
      
      <a href="https://twitter.com/javatarz" aria-label="Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter fa-lg"></i></a>
      
      <a href="https://www.linkedin.com/in/karunjaphet" aria-label="LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-linkedin fa-lg"></i></a>
      
      <a href="mailto:karun@japhet.in" rel="tooltip" title="karun@japhet.in" target="_blank"><i class="fa fa-envelope fa-lg"></i></a>
      <a href="/atom.xml" title="RSS Feed" target="_blank" rel="noopener"><i class="fa fa-rss fa-lg"></i></a>
  </p>

  <p>
    <small>
      Copyright © 2006 - 2021 <br>
      <a href="https://karun.me" target="_blank" rel="noopener noreferrer">Karun Japhet</a> <br>
      Powered by <a href="http://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a>
    </small>
  </p>
</footer>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    

    

    <noscript id="deferred-styles">
    <link href="https://fonts.googleapis.com/css?family=Arvo:400,700,400italic" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="/assets/css/overrides.css?v=">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/solid.css" integrity="sha384-rdyFrfAIC05c5ph7BKz3l5NG5yEottvO/DQ0dCrwD8gzeQDjYBHNr1ucUpQuljos" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/brands.css" integrity="sha384-QT2Z8ljl3UupqMtQNmPyhSPO/d5qbrzWmFxJqmY7tqoTuT2YrQLEqzvVOP2cT5XW" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/fontawesome.css" integrity="sha384-u5J7JghGz0qUrmEsWzBQkfvc8nK3fUT7DCaQzNQ+q4oEXhGSx+P2OqjWsfIRB8QT" crossorigin="anonymous">
    <script src="/assets/js/scale.fix.js"></script>
</noscript>
<script>
    var loadDeferredStyles = function() {
    var addStylesNode = document.getElementById("deferred-styles");
    var replacement = document.createElement("div");
    replacement.innerHTML = addStylesNode.textContent;
    document.body.appendChild(replacement)
    addStylesNode.parentElement.removeChild(addStylesNode);
    };
    var raf = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
        window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    if (raf) raf(function() { window.setTimeout(loadDeferredStyles, 0); });
    else window.addEventListener('load', loadDeferredStyles);
</script>

  </body>
</html>
