#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run lint-staged for quick checks
npx lint-staged

# Check if any CSS files were changed
if git diff --cached --name-only | grep -q "\.css$"; then
  echo "ğŸ¨ CSS files changed - running visual tests..."

  # Run quick visual regression tests (only on changed viewports)
  npm run test:visual -- --grep "@visual" --project=chromium || {
    echo "âŒ Visual tests failed. Please check the changes."
    echo "ğŸ’¡ Run 'npm run test:visual' to see detailed results."
    exit 1
  }
fi

# Check if any JS files were changed
if git diff --cached --name-only | grep -q "\.js$"; then
  echo "ğŸ“ JavaScript files changed - checking functionality..."

  # Run focused E2E tests
  npm run test:e2e -- --project=chromium --grep "theme toggle|copy button|progress bar" || {
    echo "âŒ Functionality tests failed. Please check the changes."
    echo "ğŸ’¡ Run 'npm run test:e2e' to see detailed results."
    exit 1
  }
fi

echo "âœ… All pre-commit checks passed!"